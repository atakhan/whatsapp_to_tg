# üìã –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞—Ä—Å–µ—Ä–∞ —á–∞—Ç–æ–≤ WhatsApp Web

## üéØ –¶–µ–ª—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π DOM-–ø–∞—Ä—Å–µ—Ä –≤ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. **–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ `ChatParser` (803 —Å—Ç—Ä–æ–∫–∏)
2. **–¢–æ–ª—å–∫–æ DOM-–ø–∞—Ä—Å–∏–Ω–≥** - —Ö—Ä—É–ø–∫–∏–π, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã HTML
3. **–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ Store** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π state WhatsApp Web
4. **–ù–µ—Ç CDP-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º network payloads
5. **–ù–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** - —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∫—Ä–æ–ª–ª–∞
6. **–°–º–µ—à–∞–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å** - —Å–∫—Ä–æ–ª–ª, –ø–∞—Ä—Å–∏–Ω–≥, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
7. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** - –Ω–µ —Å–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
8. **–•—Ä—É–ø–∫–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - ID –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ aria-label —á–µ—Ä–µ–∑ regex

---

## üèóÔ∏è –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    ChatParsingOrchestrator                  ‚îÇ
‚îÇ  (–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –≤—ã–±–∏—Ä–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                   ‚îÇ                   ‚îÇ
        ‚ñº                   ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ IChatSource  ‚îÇ   ‚îÇ  Normalizer  ‚îÇ   ‚îÇ IdentityRes. ‚îÇ
‚îÇ  (–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è)‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                   ‚îÇ                   ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ StoreChatSource                    ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ CDPNetworkChatSource               ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ DOMChatSource (fallback)           ‚îÇ
                            ‚îÇ                   ‚îÇ
                            ‚ñº                   ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Completion  ‚îÇ   ‚îÇ  Publisher   ‚îÇ
                    ‚îÇ  Controller  ‚îÇ   ‚îÇ              ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ                   ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚ñº
                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                              ‚îÇ   ChatDTO    ‚îÇ
                              ‚îÇ   (–º–æ–¥–µ–ª—å)   ‚îÇ
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

### 1. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (`models/`)

#### `chat_dto.py`
```python
from dataclasses import dataclass
from typing import Literal, Optional

@dataclass
class ChatDTO:
    id: str
    type: Literal["personal", "group", "broadcast"]
    name: Optional[str]
    avatar: Optional[str]
    unread_count: int
    source: Literal["store", "network", "dom"]
    integrity: Literal["verified", "fallback", "ambiguous"]
    raw_data: dict  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```

#### `parsing_result.py`
```python
from dataclasses import dataclass
from typing import List, Literal, Optional
from .chat_dto import ChatDTO

@dataclass
class ParsingResult:
    chats: List[ChatDTO]
    completeness: Literal["complete", "partial"]
    collected: int
    expected: Optional[int]
    missing_ids: List[str]
    source_type: str
    anomalies: List[dict]
    metadata: dict
```

---

### 2. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (`sources/`)

#### `base.py` - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞
```python
from abc import ABC, abstractmethod
from typing import List, Optional
from ..models.chat_dto import ChatDTO

class RawChat:
    """–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —á–∞—Ç–∞ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞"""
    pass

class IChatSource(ABC):
    @abstractmethod
    async def init(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞"""
        pass
    
    @abstractmethod
    async def fetch_batch(self) -> List[RawChat]:
        """–ü–æ–ª—É—á–∏—Ç—å –±–∞—Ç—á —á–∞—Ç–æ–≤"""
        pass
    
    @abstractmethod
    async def is_complete(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"""
        pass
    
    @abstractmethod
    async def total_expected(self) -> Optional[int]:
        """–û–∂–∏–¥–∞–µ–º–æ–µ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ"""
        pass
    
    @property
    @abstractmethod
    def source_name(self) -> str:
        """–ò–º—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"""
        pass
```

#### `store_chat_source.py` - Store –∏—Å—Ç–æ—á–Ω–∏–∫ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π)
```python
from playwright.async_api import Page
from .base import IChatSource, RawChat

class StoreChatSource(IChatSource):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –∏–∑ window.Store WhatsApp Web"""
    
    def __init__(self, page: Page):
        self.page = page
        self._initialized = False
        self._total_count = None
    
    async def init(self) -> None:
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Store"""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ window.Store
        # –ü–æ–ª—É—á–∞–µ–º total_chat_count
        pass
    
    async def fetch_batch(self) -> List[RawChat]:
        """–ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —á–∞—Ç—ã –∏–∑ Store"""
        # window.Store.Chat.models –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
        pass
    
    async def is_complete(self) -> bool:
        """–í—Å–µ–≥–¥–∞ true –¥–ª—è Store (–¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø–æ–ª–Ω—ã–µ)"""
        return True
    
    async def total_expected(self) -> Optional[int]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ–º total_chat_count –∏–∑ Store"""
        return self._total_count
```

#### `cdp_network_chat_source.py` - CDP Network –∏—Å—Ç–æ—á–Ω–∏–∫
```python
from playwright.async_api import Page, CDPSession
from .base import IChatSource, RawChat

class CDPNetworkChatSource(IChatSource):
    """–ü–µ—Ä–µ—Ö–≤–∞—Ç network payloads —á–µ—Ä–µ–∑ CDP"""
    
    def __init__(self, page: Page):
        self.page = page
        self.cdp_session: Optional[CDPSession] = None
        self._collected_payloads = []
        self._total_count = None
    
    async def init(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º CDP —Å–µ—Å—Å–∏—é –∏ –≤–∫–ª—é—á–∞–µ–º Network domain"""
        # page.context.new_cdp_session(page)
        # cdp_session.send('Network.enable')
        # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ Network.responseReceived
        pass
    
    async def fetch_batch(self) -> List[RawChat]:
        """–ò–∑–≤–ª–µ–∫–∞–µ–º —á–∞—Ç—ã –∏–∑ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö network payloads"""
        # –ü–∞—Ä—Å–∏–º protobuf / JSON –∏–∑ network responses
        pass
    
    async def is_complete(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ total_chat_count –∏–∑ payload"""
        pass
```

#### `dom_chat_source.py` - DOM fallback –∏—Å—Ç–æ—á–Ω–∏–∫
```python
from playwright.async_api import Page
from .base import IChatSource, RawChat

class DOMChatSource(IChatSource):
    """DOM-–ø–∞—Ä—Å–∏–Ω–≥ –∫–∞–∫ fallback (—Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞)"""
    
    def __init__(self, page: Page):
        self.page = page
        self._seen_ids = set()
        self._scroll_iterations = 0
        self._no_new_chats_count = 0
    
    async def init(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DOM-–ø–∞—Ä—Å–∏–Ω–≥–∞"""
        # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        # –ò—â–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
        pass
    
    async def fetch_batch(self) -> List[RawChat]:
        """–ü–∞—Ä—Å–∏–º –≤–∏–¥–∏–º—ã–µ —á–∞—Ç—ã –∏–∑ DOM"""
        # –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ _parse_all_visible_chats
        # –ù–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º RawChat –≤–º–µ—Å—Ç–æ Dict
        pass
    
    async def is_complete(self) -> bool:
        """–≠–≤—Ä–∏—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (—É–ª—É—á—à–µ–Ω–Ω–∞—è)"""
        # –î–æ—Å—Ç–∏–≥–ª–∏ –∫–æ–Ω—Ü–∞ –ò –Ω–µ—Ç –Ω–æ–≤—ã—Ö —á–∞—Ç–æ–≤
        pass
    
    async def total_expected(self) -> Optional[int]:
        """–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ –¥–ª—è DOM"""
        return None
```

#### `source_selector.py` - –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞
```python
from typing import Optional
from playwright.async_api import Page
from .store_chat_source import StoreChatSource
from .cdp_network_chat_source import CDPNetworkChatSource
from .dom_chat_source import DOMChatSource
from .base import IChatSource

class SourceSelector:
    """–í—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö"""
    
    @staticmethod
    async def select_source(page: Page) -> IChatSource:
        """–ü—Ä–æ–±—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞"""
        # 1. StoreChatSource
        # 2. CDPNetworkChatSource
        # 3. DOMChatSource (fallback)
        pass
```

---

### 3. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (`normalizers/`)

#### `chat_normalizer.py`
```python
from typing import List
from ..models.chat_dto import ChatDTO
from ..sources.base import RawChat

class ChatNormalizer:
    """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç RawChat –≤ ChatDTO"""
    
    def normalize(self, raw_chat: RawChat, source: str) -> ChatDTO:
        """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –æ–¥–∏–Ω —á–∞—Ç"""
        # –ò–∑–≤–ª–µ–∫–∞–µ–º id, type, name, avatar, unread_count
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º integrity —Å—Ç–∞—Ç—É—Å
        pass
    
    def normalize_batch(self, raw_chats: List[RawChat], source: str) -> List[ChatDTO]:
        """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –±–∞—Ç—á —á–∞—Ç–æ–≤"""
        pass
```

---

### 4. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`identity/`)

#### `identity_resolver.py`
```python
from typing import List, Set
from ..models.chat_dto import ChatDTO

class IdentityResolver:
    """–ù–∞–¥–µ–∂–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–∞—Ç–æ–≤"""
    
    def extract_id(self, raw_chat: RawChat, source: str) -> Optional[str]:
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç ID –∏–∑ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
        # 1. jid –∏–∑ store
        # 2. wid –∏–∑ store
        # 3. id.server_id –∏–∑ network
        # 4. user_id –∏–∑ network
        # –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º aria-label, textContent, regex –Ω–∞ –Ω–æ–º–µ—Ä
        pass
    
    def detect_ambiguities(self, chats: List[ChatDTO]) -> List[dict]:
        """–î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö"""
        # –†–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞ —É –æ–¥–Ω–æ–≥–æ ID
        # ID –µ—Å—Ç—å –≤ –æ–¥–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ, –Ω–æ –Ω–µ—Ç –≤ –¥—Ä—É–≥–æ–º
        pass
```

---

### 5. –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (`completion/`)

#### `completion_controller.py`
```python
from typing import List, Optional
from ..models.chat_dto import ChatDTO
from ..sources.base import IChatSource

class CompletionController:
    """–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"""
    
    def check_completion(
        self,
        collected_chats: List[ChatDTO],
        source: IChatSource
    ) -> tuple[bool, Optional[int], List[str]]:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
        
        Returns:
            (is_complete, expected_total, missing_ids)
        """
        # 1. –ü–æ–ª—É—á–∞–µ–º total_expected –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        # 2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º len(collected_chats) —Å total_expected
        # 3. –ï—Å–ª–∏ source.is_complete() == True, —Å—á–∏—Ç–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º
        # 4. –í—ã—á–∏—Å–ª—è–µ–º missing_ids –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è
        pass
```

---

### 6. –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (`publishers/`)

#### `result_publisher.py`
```python
from typing import AsyncGenerator, List
from ..models.chat_dto import ChatDTO
from ..models.parsing_result import ParsingResult

class ResultPublisher:
    """–ü—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞"""
    
    async def publish_stream(
        self,
        chats: AsyncGenerator[List[ChatDTO], None]
    ) -> AsyncGenerator[ParsingResult, None]:
        """–°—Ç—Ä–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω–∏—è"""
        pass
    
    async def publish_final(
        self,
        chats: List[ChatDTO],
        completeness: str,
        metadata: dict
    ) -> ParsingResult:
        """–ü—É–±–ª–∏–∫—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
        pass
```

---

### 7. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (`orchestrator.py`)

#### `chat_parsing_orchestrator.py`
```python
from typing import AsyncGenerator, List
from playwright.async_api import Page
from ..models.chat_dto import ChatDTO
from ..models.parsing_result import ParsingResult
from ..sources.source_selector import SourceSelector
from ..normalizers.chat_normalizer import ChatNormalizer
from ..identity.identity_resolver import IdentityResolver
from ..completion.completion_controller import CompletionController
from ..publishers.result_publisher import ResultPublisher

class ChatParsingOrchestrator:
    """–ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–∞—Ç–æ–≤"""
    
    def __init__(self):
        self.source_selector = SourceSelector()
        self.normalizer = ChatNormalizer()
        self.identity_resolver = IdentityResolver()
        self.completion_controller = CompletionController()
        self.publisher = ResultPublisher()
    
    async def parse_chats_streaming(
        self,
        page: Page
    ) -> AsyncGenerator[ParsingResult, None]:
        """–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º"""
        # 1. –í—ã–±–∏—Ä–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
        # 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
        # 3. –í —Ü–∏–∫–ª–µ:
        #    - fetch_batch()
        #    - normalize()
        #    - resolve_identity()
        #    - publish()
        #    - check_completion()
        # 4. –ü—É–±–ª–∏–∫—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        pass
```

---

## üîÑ –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1-2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (`ChatDTO`, `ParsingResult`, `RawChat`)
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IChatSource`
4. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π

**–§–∞–π–ª—ã:**
- `backend/app/services/whatsapp/parsing/models/__init__.py`
- `backend/app/services/whatsapp/parsing/models/chat_dto.py`
- `backend/app/services/whatsapp/parsing/models/parsing_result.py`
- `backend/app/services/whatsapp/parsing/models/raw_chat.py`

---

### –≠—Ç–∞–ø 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (3-4 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `StoreChatSource` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π)
   - –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `window.Store` –≤ WhatsApp Web
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ `Store.Chat.models`
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `total_chat_count`
   
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `CDPNetworkChatSource`
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDP —Å–µ—Å—Å–∏—é
   - –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å network requests
   - –ü–∞—Ä—Å–∏–Ω–≥ protobuf/JSON payloads
   
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DOMChatSource` (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞)
   - –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ `ChatParser._parse_all_visible_chats`
   - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IChatSource`
   
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `SourceSelector`
   - –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

**–§–∞–π–ª—ã:**
- `backend/app/services/whatsapp/parsing/sources/__init__.py`
- `backend/app/services/whatsapp/parsing/sources/base.py`
- `backend/app/services/whatsapp/parsing/sources/store_chat_source.py`
- `backend/app/services/whatsapp/parsing/sources/cdp_network_chat_source.py`
- `backend/app/services/whatsapp/parsing/sources/dom_chat_source.py`
- `backend/app/services/whatsapp/parsing/sources/source_selector.py`

---

### –≠—Ç–∞–ø 3: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ChatNormalizer`
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `RawChat` ‚Üí `ChatDTO`
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —á–∞—Ç–∞ (personal/group/broadcast)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ integrity —Å—Ç–∞—Ç—É—Å–∞
   
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `IdentityResolver`
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ID –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π (—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ ID

**–§–∞–π–ª—ã:**
- `backend/app/services/whatsapp/parsing/normalizers/__init__.py`
- `backend/app/services/whatsapp/parsing/normalizers/chat_normalizer.py`
- `backend/app/services/whatsapp/parsing/identity/__init__.py`
- `backend/app/services/whatsapp/parsing/identity/identity_resolver.py`

---

### –≠—Ç–∞–ø 4: –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è (1-2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `CompletionController`
   - –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ `missing_ids`
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ completeness —Å—Ç–∞—Ç—É—Å–∞
   
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ResultPublisher`
   - –°—Ç—Ä–∏–º–∏–Ω–≥ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ `ParsingResult`

**–§–∞–π–ª—ã:**
- `backend/app/services/whatsapp/parsing/completion/__init__.py`
- `backend/app/services/whatsapp/parsing/completion/completion_controller.py`
- `backend/app/services/whatsapp/parsing/publishers/__init__.py`
- `backend/app/services/whatsapp/parsing/publishers/result_publisher.py`

---

### –≠—Ç–∞–ø 5: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ChatParsingOrchestrator`
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ `parse_chats_streaming()`
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏
   
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `WhatsAppConnectService`
   - –ó–∞–º–µ–Ω–∏—Ç—å `ChatParser` –Ω–∞ `ChatParsingOrchestrator`
   - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å API –º–µ—Ç–æ–¥—ã
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
   
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å API endpoints
   - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç `ParsingResult`
   - –û–±–Ω–æ–≤–∏—Ç—å SSE —Å–æ–±—ã—Ç–∏—è

**–§–∞–π–ª—ã:**
- `backend/app/services/whatsapp/parsing/__init__.py`
- `backend/app/services/whatsapp/parsing/orchestrator.py`
- `backend/app/services/whatsapp/whatsapp_service.py` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- `backend/app/api/whatsapp.py` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

---

### –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
2. ‚úÖ Integration-—Ç–µ—Å—Ç—ã –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. ‚úÖ –¢–µ—Å—Ç—ã –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ (fallback –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏)
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
5. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≥–∞–π–¥

**–§–∞–π–ª—ã:**
- `backend/tests/services/whatsapp/parsing/` (—Ç–µ—Å—Ç—ã)
- `backend/app/services/whatsapp/parsing/README.md`
- `backend/app/services/whatsapp/parsing/MIGRATION.md`

---

### –≠—Ç–∞–ø 7: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1-2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π `ChatParser`
2. ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥
3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π code review

---

## üìù –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### StoreChatSource - –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–®–∞–≥ 1: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ**
```javascript
// –í page.evaluate()
const store = window.Store || window.WWebJS;
console.log('Store keys:', Object.keys(store));
console.log('Chat models:', store.Chat?.models);
console.log('Total count:', store.Chat?.models?.length);
```

**–®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
```javascript
const chats = store.Chat.models.map(chat => ({
    jid: chat.id?._serialized || chat.id,
    name: chat.name || chat.contact?.name,
    isGroup: chat.isGroup,
    unreadCount: chat.unreadCount,
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}));
```

### CDPNetworkChatSource - –ü–µ—Ä–µ—Ö–≤–∞—Ç network

**–®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CDP**
```python
cdp_session = await page.context.new_cdp_session(page)
await cdp_session.send('Network.enable')

# –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
async def handle_response(event):
    if 'chat' in event.get('response', {}).get('url', ''):
        # –ü–∞—Ä—Å–∏–º payload
        pass

cdp_session.on('Network.responseReceived', handle_response)
```

**–®–∞–≥ 2: –ü–∞—Ä—Å–∏–Ω–≥ protobuf**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è protobuf
- –ò–ª–∏ –ø–∞—Ä—Å–∏—Ç—å JSON –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω

### IdentityResolver - –ù–∞–¥–µ–∂–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ ID:**
1. `raw_chat.jid` (–∏–∑ Store)
2. `raw_chat.wid` (–∏–∑ Store)
3. `raw_chat.id.server_id` (–∏–∑ Network)
4. `raw_chat.user_id` (–∏–∑ Network)

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- ‚ùå Regex –Ω–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–∑ aria-label
- ‚ùå –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ textContent
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ title –∞—Ç—Ä–∏–±—É—Ç–∞

---

## üß™ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit-—Ç–µ—Å—Ç—ã

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:**
- Mock Page/CDP session
- –¢–µ—Å—Ç `init()`, `fetch_batch()`, `is_complete()`, `total_expected()`

**–î–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä–∞:**
- –¢–µ—Å—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è RawChat ‚Üí ChatDTO
- –¢–µ—Å—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —á–∞—Ç–∞
- –¢–µ—Å—Ç integrity —Å—Ç–∞—Ç—É—Å–æ–≤

**–î–ª—è IdentityResolver:**
- –¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è ID –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –¢–µ—Å—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏ –∞–Ω–æ–º–∞–ª–∏–π

### Integration-—Ç–µ—Å—Ç—ã

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
1. Store –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ —á–∞—Ç—ã
2. Store –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –Ω–∞ CDP
3. CDP –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –Ω–∞ DOM
4. –ß–∞—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π completeness —Å—Ç–∞—Ç—É—Å
5. –ê–Ω–æ–º–∞–ª–∏–∏ ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:
- ‚úÖ –í—Å–µ —á–∞—Ç—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è (100% completeness)
- ‚úÖ ID –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –Ω–∞–¥–µ–∂–Ω–æ (–Ω–µ –∏–∑ aria-label)
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–Ω–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏)
- ‚úÖ Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Store

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ:
- ‚úÖ –ö–æ–¥ —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –º–æ–¥—É–ª–∏ (< 200 —Å—Ç—Ä–æ–∫ –Ω–∞ –º–æ–¥—É–ª—å)
- ‚úÖ –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- ‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è –∏ –æ—Ç—á–µ—Ç –æ–± –∞–Ω–æ–º–∞–ª–∏—è—Ö

---

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: Store —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- Fallback –Ω–∞ CDP/DOM
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞ Store

### –†–∏—Å–∫ 2: CDP payloads –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Store –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
- DOM –∫–∞–∫ –Ω–∞–¥–µ–∂–Ω—ã–π fallback

### –†–∏—Å–∫ 3: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- Store –±—ã—Å—Ç—Ä–µ–µ DOM (–Ω–µ—Ç —Å–∫—Ä–æ–ª–ª–∞)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è batch —Ä–∞–∑–º–µ—Ä–æ–≤

---

## üìÖ –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 12-16 –¥–Ω–µ–π**

- –≠—Ç–∞–ø 1: 1-2 –¥–Ω—è
- –≠—Ç–∞–ø 2: 3-4 –¥–Ω—è (—Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π - –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ Store/CDP)
- –≠—Ç–∞–ø 3: 2 –¥–Ω—è
- –≠—Ç–∞–ø 4: 1-2 –¥–Ω—è
- –≠—Ç–∞–ø 5: 2-3 –¥–Ω—è
- –≠—Ç–∞–ø 6: 2-3 –¥–Ω—è
- –≠—Ç–∞–ø 7: 1-2 –¥–Ω—è

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω –ø–ª–∞–Ω —Å –∫–æ–º–∞–Ω–¥–æ–π
- [ ] –°–æ–∑–¥–∞–Ω–∞ –≤–µ—Ç–∫–∞ –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ window.Store –≤ WhatsApp Web
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –¥–æ—Å—Ç—É–ø –∫ CDP —á–µ—Ä–µ–∑ Playwright

### –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] Code review –ø—Ä–æ–π–¥–µ–Ω
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ production –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –°—Ç–∞—Ä—ã–π –∫–æ–¥ —É–¥–∞–ª–µ–Ω

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `CHAT_PARSING_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `backend/app/services/whatsapp/chat_parser.py` - —Ç–µ–∫—É—â–∏–π –∫–æ–¥ (–±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω)
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–≤ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

## üìå –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–ª–∞–Ω** —Å –∫–æ–º–∞–Ω–¥–æ–π
2. **–ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1** - —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
3. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å** —Å—Ç—Ä—É–∫—Ç—É—Ä—É window.Store –≤ WhatsApp Web
4. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å** –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å —Ç–µ—Å—Ç–∞–º–∏


